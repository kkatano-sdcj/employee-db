# Savepoint: 2025-11-18 (Contract tabs & plan alignment)

## 状況サマリ
- Next.js App Router ベースの従業員管理UIを構築。Supabase(Postgres)から employees/work_conditions/contracts/employee_admin_records を直接取得する仕組み（`postgres` クライアント + Server Components）を実装済み。
- 従業員詳細画面に Plan3 デザイン準拠のタブ構成（雇用情報/勤務情報/給与・手当/契約履歴/書類/備考）を実装。タブはクエリパラメータ `view` で切替可能。
- 雇用情報タブは社員番号・部門に加え `employment_expiry_scheduled_date` / `employment_expiry_date` を表示。契約履歴タブでは全契約の期間（開始〜満了予定日）と実満了日を表示。
- 給与・手当タブは contracts + employee_admin_records + transportation_routes の情報を表示。書類タブは提出/返却状況、備考タブは契約メモ/更新者を表示。
- `fetchEmployeeDetail` は employee_admin_records の提出状況フィールドと `adminRecord` を返却するよう拡張済み。
- `.env` は git 管理対象外。PLANS.md は `specs/002-contract-expiry-date/spec.md` の要件（雇用満了予定日/実満了日の管理、アラート再計算、契約履歴表示）に合わせて更新済み。

## 直近作業
1. Supabase 接続層 (`apps/nextjs/src/env.ts`, `src/server/db.ts`) を整備し、ルート `.env` から環境変数を読込。
2. Dashboard / Employees / Contracts / Reports / Settings ページ実装。Employees 詳細はタブ構成、一覧は検索/フィルタ/CTA を備える。
3. 従業員詳細タブの拡張
   - 勤務情報タブ: 勤務時間/休憩/勤務地/交通費/有休メモをカード表示。
   - 給与・手当タブ: 時給/残業時給/最寄り駅/交通費/控除申告書/各種保険を表示。
   - 契約履歴タブ: すべての契約をカード表示（開始日、雇用満了予定日、実満了日、業務内容）。
   - 書類タブ: 提出日・本人返却・満了通知書・退職届・返却物ステータス。
   - 備考タブ: 契約ノート（hourly_wage_note）と更新情報基本枠。
4. `fetchEmployeeDetail` で `employment_expiry_scheduled_date` / `employment_expiry_date`・`adminRecord` の提出/返却情報をまとめて取得するよう更新。
5. `PLANS.md` を `specs/002-contract-expiry-date/spec.md` に合わせて修正。契約CRUD/アラート/フロントタブ/DoD を満了予定日仕様込みで再定義。
6. `.env` を履歴から除去、`.gitignore` へ登録し、リポジトリをクリーンに維持。

## 未完了/次ステップ候補
- 契約CRUDのサーバ実装（Prisma + tRPC）と満了予定日/満了日バリデーション。
- 契約更新アラート実処理（スケジューラ + 通知テーブル）と再計算ロジック。
- 契約編集画面での `employment_expiry_scheduled_date` / `employment_expiry_date` 入力UI。
- `specs/003-work-conditions-consolidation` で要求されている勤務条件集約の実装（未着手）。
- 給与・備考タブの実データ連携（現在一部Placeholder）。
- テスト（ユニット/統合）とCI整備。
