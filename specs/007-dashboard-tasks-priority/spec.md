# Feature Specification: ダッシュボードの重要タスク優先度表示と統計カード

**Feature Branch**: `007-dashboard-tasks-priority`  
**Created**: 2025-11-19  
**Status**: Draft  
**Input**: User description: "ダッシュボードの仕様も変更します。本日の重要タスクの一覧のステータスの表示を変更します。要更新と表示されているものは赤色で表示するようにしてください。ステータスが要更新のユーザーの優先度は高にします。契約が60日以上残っているユーザーは、優先度を中にします。契約が90日以上残っているユーザーは、優先度を低にします。ダッシュボード上に表示するデザインカードはその従業員数、今月の契約処理、契約更新予定の3つにします。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 本日の重要タスクの優先度表示とステータス色分け (Priority: P1)

統括人事管理者がダッシュボードの「本日の重要タスク」一覧を表示した際、各タスクのステータスが「要更新」の場合は赤色で表示され、優先度が正しく設定されている。

**Why this priority**: ダッシュボードはユーザーが最初に目にする画面であり、重要なタスクを視覚的に識別できることが重要です。ステータスの色分けと優先度の設定により、ユーザーは緊急度の高いタスクを素早く識別し、効率的に作業を進められます。

**Independent Test**: 統括人事管理者がダッシュボードを表示し、「本日の重要タスク」一覧で「要更新」ステータスのタスクが赤色で表示され、優先度が「高」に設定されていることを確認します。契約残り日数に応じて優先度が「中」または「低」に設定されていることも検証できます。

**Acceptance Scenarios**:

1. **Given** 統括人事管理者がダッシュボードを表示している, **When** 「本日の重要タスク」一覧を確認する, **Then** ステータスが「要更新」のタスクが赤色で表示される
2. **Given** 統括人事管理者がダッシュボードを表示している, **When** ステータスが「要更新」のタスクを確認する, **Then** そのタスクの優先度が「高」に設定されている
3. **Given** 統括人事管理者がダッシュボードを表示している, **When** 契約が60日以上90日未満残っている従業員のタスクを確認する, **Then** そのタスクの優先度が「中」に設定されている
4. **Given** 統括人事管理者がダッシュボードを表示している, **When** 契約が90日以上残っている従業員のタスクを確認する, **Then** そのタスクの優先度が「低」に設定されている
5. **Given** 統括人事管理者がダッシュボードを表示している, **When** 「本日の重要タスク」一覧を優先度でソートする, **Then** 優先度「高」のタスクが最上部に表示され、次に「中」、「低」の順で表示される

---

### User Story 2 - ダッシュボード統計カードの表示 (Priority: P1)

統括人事管理者がダッシュボードを表示した際、3つの統計カード（従業員数、今月の契約処理、契約更新予定）が表示される。

**Why this priority**: ダッシュボードの統計カードは、システム全体の状況を一目で把握するための重要な情報です。従業員数、今月の契約処理数、契約更新予定数を表示することで、ユーザーは業務の全体像を素早く理解できます。

**Independent Test**: 統括人事管理者がダッシュボードを表示し、3つの統計カード（従業員数、今月の契約処理、契約更新予定）が正しく表示されることを確認します。各カードに正確な数値が表示されることも検証できます。

**Acceptance Scenarios**:

1. **Given** 統括人事管理者がダッシュボードを表示している, **When** 統計カードセクションを確認する, **Then** 「従業員数」「今月の契約処理」「契約更新予定」の3つのカードが表示される
2. **Given** 統括人事管理者がダッシュボードを表示している, **When** 「従業員数」カードを確認する, **Then** 現在の従業員総数が表示される
3. **Given** 統括人事管理者がダッシュボードを表示している, **When** 「今月の契約処理」カードを確認する, **Then** 今月（当月）に処理された契約の件数が表示される
4. **Given** 統括人事管理者がダッシュボードを表示している, **When** 「契約更新予定」カードを確認する, **Then** 今後30日以内に更新予定の契約件数が表示される
5. **Given** 統括人事管理者がダッシュボードを表示している, **When** 各統計カードをクリックする, **Then** 該当する詳細画面（従業員一覧、契約一覧など）に遷移できる

---

### Edge Cases

- 契約が60日未満残っているが「要更新」ステータスでない場合、優先度は「高」とする（契約残り日数が少ないため）
- 契約がちょうど60日残っている場合、優先度は「中」とする（60日以上に該当）
- 契約がちょうど90日残っている場合、優先度は「低」とする（90日以上に該当）
- 契約満了予定日が設定されていない（NULL）場合、優先度の判定方法（「要更新」ステータスがある場合は「高」、ない場合は「中」とする）
- 複数の契約を持つ従業員の場合、最も近い契約満了予定日を基準に優先度を判定する
- 今月の契約処理カードで、契約の作成・更新・削除のすべてを「処理」としてカウントするか、特定の操作のみをカウントするか（作成と更新のみをカウントすることを想定）
- 契約更新予定カードで、どの期間内の更新予定を表示するか（30日以内、60日以内など、デフォルトは30日以内とする）

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムはダッシュボードの「本日の重要タスク」一覧で、ステータスが「要更新」のタスクを赤色で表示すること。
- **FR-002**: システムは「本日の重要タスク」一覧で、各タスクの優先度を以下のルールに基づいて設定すること：
  - ステータスが「要更新」の場合、優先度を「高」とする
  - 契約が90日以上残っている場合、優先度を「低」とする
  - 契約が60日以上90日未満残っている場合、優先度を「中」とする
  - 契約が60日未満残っている場合、優先度を「高」とする
- **FR-003**: システムは「本日の重要タスク」一覧で、優先度に基づいてタスクをソートし、優先度「高」を最上部に表示すること。
- **FR-004**: システムはダッシュボードに3つの統計カードを表示すること：
  - 「従業員数」カード：現在の従業員総数を表示
  - 「今月の契約処理」カード：今月（当月）に処理された契約の件数を表示（契約の作成と更新をカウント）
  - 「契約更新予定」カード：今後30日以内に更新予定の契約件数を表示
- **FR-005**: システムは各統計カードをクリックした際、該当する詳細画面（従業員一覧、契約一覧など）に遷移できること。
- **FR-006**: システムは契約残り日数の計算を、契約満了予定日（employment_expiry_scheduled_date）から当日の日付を引いた日数で行うこと。
- **FR-007**: システムは複数の契約を持つ従業員の場合、最も近い契約満了予定日を基準に優先度を判定すること。
- **FR-008**: システムは契約満了予定日が設定されていない（NULL）場合、優先度の判定において「要更新」ステータスがある場合は「高」、ない場合は「中」とすること。

### Key Entities *(include if feature involves data)*

- **契約（Contract）**: 雇用契約を表し、以下の情報を含む：
  - `employment_expiry_scheduled_date` (DATE): 雇用満了予定日（契約残り日数の計算に使用）
  - 契約残り日数は `employment_expiry_scheduled_date - CURRENT_DATE` で計算される
- **従業員（Employee）**: 従業員を表し、以下の情報を含む：
  - 複数の契約を持つ場合、最も近い契約満了予定日を基準に優先度が判定される
  - 「要更新」ステータスは、契約満了予定日が当日を過ぎている場合に設定される

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ダッシュボードの「本日の重要タスク」一覧で、ステータスが「要更新」のタスクが100%の精度で赤色で表示されること
- **SC-002**: ダッシュボードの「本日の重要タスク」一覧で、各タスクの優先度が契約残り日数と「要更新」ステータスに基づいて100%の精度で正しく設定されること
- **SC-003**: ダッシュボードの「本日の重要タスク」一覧で、優先度「高」のタスクが最上部に表示され、次に「中」、「低」の順で表示されること（100%の精度）
- **SC-004**: ダッシュボードに3つの統計カード（従業員数、今月の契約処理、契約更新予定）が100%の精度で表示されること
- **SC-005**: 各統計カードに正確な数値が表示されること（従業員数：100%の精度、今月の契約処理：100%の精度、契約更新予定：100%の精度）
- **SC-006**: 統括人事管理者がダッシュボードを表示してから、重要タスクの優先度を識別するまでの時間が2秒以内であること
- **SC-007**: 統計カードをクリックした際、該当する詳細画面に1秒以内に遷移できること

## UI要件

- **UI-001**: システムは「要更新」ステータスを赤色で表示し、視覚的に識別しやすい形式（例：赤色のテキスト、赤色のバッジ、赤色の背景など）で表示すること。
- **UI-002**: システムは「本日の重要タスク」一覧で、優先度を視覚的に識別できる形式（例：優先度「高」は強調表示、優先度「中」は通常表示、優先度「低」は控えめな表示）で表示すること。
- **UI-003**: システムは統計カードを、視覚的に区別できる形式（例：カード形式、アイコン付き、数値の強調表示など）で表示すること。
- **UI-004**: システムは統計カードをクリック可能な形式で表示し、ホバー時に視覚的なフィードバック（例：カーソル変更、カードの強調表示など）を提供すること。

## 前提条件

- ダッシュボード画面が既に存在し、「本日の重要タスク」一覧が表示されていること
- 契約テーブルに雇用満了予定日（employment_expiry_scheduled_date）フィールドが存在すること（002-contract-expiry-dateで実装済み）
- 「要更新」ステータスの判定機能が実装されていること（004-contract-update-indicatorで実装済み）
- ユーザーは適切なアクセス認証情報とロール割り当て（統括人事管理者、現場マネージャー、管理者）を持っていること

## 依存関係

- 既存のダッシュボード機能（001-employee-db-requirements）
- 契約テーブルの雇用満了日管理機能（002-contract-expiry-date）
- 契約満了予定日超過時の「要更新」表示機能（004-contract-update-indicator）
- 従業員管理機能（001-employee-db-requirements）
- 契約管理機能（001-employee-db-requirements）

## 対象外

- 統計カードの詳細な分析機能（数値の表示のみ）
- 優先度の手動変更機能（自動判定のみ）
- ダッシュボードのカスタマイズ機能（表示内容の固定）
- 過去の統計データの表示（現在の数値のみ）

