# Feature Specification: 従業員データベースシステム - 包括的仕様書

**Feature Branch**: `newest-branch`  
**Created**: 2025-11-19  
**Last Updated**: 2025-01-28 (契約番号管理、契約書・誓約書出力仕様、プレビュー機能、一括処理機能、employment_historyテーブルへの保存仕様の追加)  
**Status**: Draft  
**Input**: User description: "すべてのコンポーネントや機能についての最新の仕様を盛り込んだ新しい仕様書を作成してください。"

## ユーザーシナリオとテスト *(必須)*

### User Story 1 - 従業員情報の登録と管理 (Priority: P1)

統括人事管理者が新規パート従業員の基本情報（氏名、生年月日、入社日、雇用区分など）を登録し、勤務時間帯、休憩時間帯、勤務場所、交通費などの勤務条件を設定できる。

**優先度の理由**: システムの基盤となる機能であり、他のすべての機能が従業員情報に依存するため、最優先で実装する必要があります。

**独立テスト**: 統括人事管理者が新規従業員を登録し、勤務条件を設定して保存できることを確認します。この機能単体で、従業員マスターの基本機能が動作することを検証できます。

**受け入れシナリオ**:

1. **Given** 統括人事管理者がログインしている, **When** 新規従業員の基本情報（氏名、生年月日、入社日、雇用区分、部門コード）を入力して保存する, **Then** 従業員情報が正しく登録され、一覧画面に表示される
2. **Given** 従業員が登録されている, **When** 複数の勤務時間帯（例：09:00-12:00、13:00-18:00）を設定する, **Then** すべての勤務時間帯が正しく保存され、表示される
3. **Given** 従業員が登録されている, **When** 複数の勤務場所と交通費情報（ルート別、往復金額、月額定期、上限金額）を設定する, **Then** すべての情報が正しく保存され、契約書出力時に反映される
4. **Given** 従業員情報が登録されている, **When** 情報を更新する, **Then** 最終更新日時と更新者が記録される

---

### User Story 2 - 雇用契約書の作成とPDF出力 (Priority: P1)

統括人事管理者が雇用契約書を作成し、PDF形式で出力できる。契約書には枝番が自動付与され、承認番号を管理できる。契約書.pdfを元にしたフォーマットを使用し、データベースの登録情報から以下の項目を自動入力して契約書を作成する：契約者の氏名（**殿の部分）、右上の契約書の作成年月日、雇用期間（期間の定めアリの部分と赤字の基準日）、就業の場所（赤字部分）、業務の内容（赤字部分）、勤務日、社会保険加入、休暇（赤字部分）、賃金（赤字部分）。また、誓約書.pdfを元にしたフォーマットを使用し、社員番号のみをデータベースから取得して入力し、その他の部分はそのままPDFで出力できる。

**優先度の理由**: 雇用契約書からの手入力作業を廃止するという主要目的を達成するための核心機能です。法的文書としての契約書を正確に出力できることが必須です。契約書と誓約書の両方をPDF形式で出力できることで、入社手続きの効率化が図れます。

**独立テスト**: 統括人事管理者が従業員の契約情報を入力し、契約書をPDF形式で出力できることを確認します。出力されたPDFに必要な情報（契約者の氏名、作成年月日、雇用期間、就業の場所、業務の内容、勤務日、社会保険加入、休暇、賃金など）がすべて含まれていることを検証できます。また、誓約書をPDF形式で出力し、社員番号が正しく入力されていることを検証できます。

**受け入れシナリオ**:

1. **Given** 従業員情報と勤務条件が登録されている, **When** 雇用契約書を作成してPDF出力する, **Then** 契約書.pdfを元にしたフォーマットで、契約者の氏名（**殿の部分）、作成年月日、雇用期間、就業の場所、業務の内容、勤務日、社会保険加入、休暇、賃金などの情報が含まれたPDFが生成される
2. **Given** 契約書が作成されている, **When** 契約書を出力する, **Then** 社員番号に枝番が自動付与される
3. **Given** 契約書を作成する, **When** 承認番号を入力する, **Then** 承認番号が契約書に表示され、履歴として管理される
4. **Given** 契約内容が変更された, **When** 契約書を再作成する, **Then** 既存契約書が無効化され、新しい承認番号の入力が必須となる
5. **Given** 従業員情報が登録されている, **When** 契約書.pdfを元にした契約書をPDF出力する, **Then** データベースの登録情報から契約者の氏名（**殿の部分）、作成年月日、雇用期間（期間の定めアリの部分と赤字の基準日）、就業の場所（赤字部分）、業務の内容（赤字部分）、勤務日、社会保険加入、休暇（赤字部分）、賃金（赤字部分）が自動入力されたPDFが生成される
6. **Given** 従業員情報が登録されている, **When** 誓約書.pdfを元にした誓約書をPDF出力する, **Then** 社員番号のみがデータベースから取得され、フォーマットに入力され、その他の部分はそのままPDFで出力される
7. **Given** 従業員情報が登録されている, **When** 契約書と誓約書を同時に出力する, **Then** 両方のPDFが正しく生成される

---

### User Story 3 - 契約期間の管理と表示 (Priority: P1)

統括人事管理者が契約の雇用期間を、契約開始日と雇用満了予定日で管理し、実際の雇用満了日を記録できる。

**優先度の理由**: 雇用期間の正確な管理は契約管理の基盤であり、契約更新アラートや給与計算などの他の機能が正しく動作するために必須です。予定日と実際の満了日を区別することで、契約延長や早期終了の状況を正確に把握できます。

**独立テスト**: 統括人事管理者が契約を作成し、雇用満了予定日を設定し、後で実際の雇用満了日を記録できることを確認します。雇用期間が正しく表示され、契約更新アラートが適切に動作することを検証できます。

**受け入れシナリオ**:

1. **Given** 統括人事管理者が新規契約を作成する, **When** 契約開始日と雇用満了予定日を入力して保存する, **Then** 契約が正しく登録され、雇用期間（契約開始日〜雇用満了予定日）が表示される
2. **Given** 契約が登録されている, **When** 実際の雇用満了日を入力する, **Then** 雇用満了日が記録され、雇用期間の表示が更新される
3. **Given** 契約が登録されている, **When** 雇用満了予定日を変更する, **Then** 変更が保存され、契約更新アラートが新しい予定日に基づいて再計算される
4. **Given** 複数の契約が登録されている, **When** 雇用期間で検索・フィルタリングする, **Then** 契約開始日と雇用満了予定日に基づいて正しくフィルタリングされる

---

### User Story 4 - 契約満了予定日超過時の「要更新」表示 (Priority: P1)

統括人事管理者が契約管理画面、従業員管理ページ、従業員詳細ページを表示した際、契約満了予定日が当日の日付を過ぎている契約に「要更新」の表示がされる。

**優先度の理由**: 契約更新の見逃しを防ぎ、適切なタイミングで契約更新手続きを開始できることが重要です。更新が必要な契約を視覚的に識別できることで、業務効率が向上します。

**独立テスト**: 統括人事管理者が契約管理画面を表示し、契約満了予定日が過去の日付になっている契約に「要更新」の表示がされることを確認します。この機能単体で、更新が必要な契約を視覚的に識別できる価値を提供します。

**受け入れシナリオ**:

1. **Given** 契約管理画面が表示されている, **When** 契約満了予定日（employment_expiry_scheduled_date）が当日の日付を過ぎている契約が存在する, **Then** その契約に「要更新」の表示がされる
2. **Given** 従業員詳細ページが表示されている, **When** その従業員に関連する契約で契約満了予定日が当日の日付を過ぎている契約が存在する, **Then** その契約に「要更新」の表示がされる
3. **Given** 従業員管理ページが表示されている, **When** 契約満了予定日が当日の日付を過ぎている契約を持つ従業員が存在する, **Then** その従業員に「要更新」の表示がされる
4. **Given** 契約管理画面が表示されている, **When** 契約満了予定日が当日または未来の日付の契約が存在する, **Then** その契約に「要更新」の表示はされない

---

### User Story 5 - 契約管理画面の操作メニュー (Priority: P1)

統括人事管理者が契約管理画面の一覧表示で、各契約の操作列にある3点メニューをクリックし、契約書プレビュー、誓約書プレビュー、契約更新、新規契約作成、契約削除の5つの操作を選択できる。契約書プレビューまたは誓約書プレビューを選択すると、ポップアップで書類の内容が表示され、ダウンロード機能と印刷機能が利用できる。

**優先度の理由**: 契約管理画面は契約を管理する主要な画面であり、契約に対する操作を効率的に実行できることが重要です。3点メニューにより、画面をすっきり保ちながら、必要な操作に素早くアクセスできます。プレビュー機能により、契約書や誓約書の内容を確認してからダウンロードや印刷を行うことができ、作業効率が向上します。

**独立テスト**: 統括人事管理者が契約管理画面を表示し、3点メニューをクリックして5つの操作メニューが表示されることを確認します。各メニュー項目を選択して、適切な画面やアクションに遷移できることを検証できます。契約書プレビューまたは誓約書プレビューを選択した場合、ポップアップで書類が表示され、ダウンロードと印刷ができることを検証できます。

**受け入れシナリオ**:

1. **Given** 統括人事管理者が契約管理画面の一覧を表示している, **When** アラート列の右側に操作列が表示されていることを確認する, **Then** 各契約行に3点メニューアイコンが表示される
2. **Given** 統括人事管理者が契約管理画面の一覧を表示している, **When** 3点メニューアイコンをクリックする, **Then** ポップアップメニューが表示され、「契約書プレビュー」「誓約書プレビュー」「契約更新」「新規契約作成」「契約削除」の5つのメニュー項目が表示される
3. **Given** 統括人事管理者が3点メニューから「契約書プレビュー」を選択する, **When** メニュー項目をクリックする, **Then** ポップアップで契約書の内容が表示される
4. **Given** 統括人事管理者が契約書プレビューポップアップを表示している, **When** ダウンロードボタンをクリックする, **Then** 契約書がPDF形式でダウンロードされる
5. **Given** 統括人事管理者が契約書プレビューポップアップを表示している, **When** 印刷ボタンをクリックする, **Then** 契約書が印刷される
6. **Given** 統括人事管理者が3点メニューから「誓約書プレビュー」を選択する, **When** メニュー項目をクリックする, **Then** ポップアップで誓約書の内容が表示される
7. **Given** 統括人事管理者が誓約書プレビューポップアップを表示している, **When** ダウンロードボタンをクリックする, **Then** 誓約書がPDF形式でダウンロードされる
8. **Given** 統括人事管理者が誓約書プレビューポップアップを表示している, **When** 印刷ボタンをクリックする, **Then** 誓約書が印刷される
9. **Given** 統括人事管理者が3点メニューから「契約更新」を選択する, **When** メニュー項目をクリックする, **Then** 契約更新画面が表示される
10. **Given** 統括人事管理者が3点メニューから「新規契約作成」を選択する, **When** メニュー項目をクリックする, **Then** 新規契約作成画面が表示される
11. **Given** 統括人事管理者が3点メニューから「契約削除」を選択する, **When** メニュー項目をクリックし、削除確認ダイアログで確認する, **Then** 契約が削除される

---

### User Story 6 - 契約作成・更新画面での情報入力 (Priority: P1)

統括人事管理者が契約の新規作成または更新画面で、work_conditionsテーブルとcontractsテーブルの情報を入力・表示できる。契約更新または新規契約作成画面では、基本情報は表示のみで、勤務条件、雇用契約、書類・提出状況の各ウィジェットの編集および新規入力ができる。また、これらのセクションを1つの大きなウィジェットとして統合し、先頭に契約番号の入力欄を配置する。

**優先度の理由**: 契約作成・更新時に必要な情報を一括で入力できることが重要です。work_conditionsとcontractsの情報を同じ画面で入力することで、作業効率が向上し、データの整合性も保たれます。編集権限を適切に制限することで、誤操作を防ぎ、データの整合性を保つことができます。

**独立テスト**: 統括人事管理者が新規契約作成画面を表示し、contractsテーブルの情報（契約種別、契約期間、時給など）とwork_conditionsテーブルの情報（勤務時間、休憩時間、勤務場所、交通費など）を入力できることを確認します。既存の契約を更新する場合も、同様に両方のテーブルの情報を編集できることを検証できます。また、基本情報が編集不可で表示のみであることを確認します。

**受け入れシナリオ**:

1. **Given** 統括人事管理者が新規契約作成画面を表示している, **When** contractsテーブルの情報（契約種別、契約開始日、雇用満了予定日、時給、残業時給など）を入力する, **Then** 入力した情報が正しく保存される
2. **Given** 統括人事管理者が新規契約作成画面を表示している, **When** work_conditionsテーブルの情報（勤務時間帯、休憩時間帯、勤務場所、交通費情報など）を入力する, **Then** 入力した情報が正しく保存される
3. **Given** 統括人事管理者が契約更新画面を表示している, **When** 既存のcontractsテーブルとwork_conditionsテーブルの情報が表示されることを確認する, **Then** 両方のテーブルの情報が正しく表示される
4. **Given** 統括人事管理者が契約更新画面で情報を変更する, **When** 変更内容を保存する, **Then** 変更した情報が正しく保存される
5. **Given** 統括人事管理者が契約更新または新規契約作成画面を表示している, **When** 基本情報ウィジェットを確認する, **Then** 基本情報は表示のみで編集できない
6. **Given** 統括人事管理者が契約更新または新規契約作成画面を表示している, **When** 勤務条件、雇用契約、書類・提出状況のウィジェットを確認する, **Then** これらのウィジェットは編集可能である
7. **Given** 統括人事管理者が契約更新または新規契約作成画面を表示している, **When** 統合されたウィジェットの先頭を確認する, **Then** 契約番号の入力欄が表示される
8. **Given** 統括人事管理者が契約更新または新規契約作成画面で契約番号を入力する, **When** 契約番号を入力して保存する, **Then** 契約番号が正しく保存される

---

### User Story 6-1 - 従業員情報編集画面での編集権限制御 (Priority: P1)

統括人事管理者が従業員管理ページから「従業員情報を編集」画面を開いた場合、基本情報の編集のみができ、勤務条件、雇用契約、書類・提出状況のウィジェットには登録情報を表示するのみとなる。ただし、勤務条件、雇用契約、書類・提出状況は1つの契約番号で管理され、これらのウィジェットに対して契約番号を入力・管理できる。

**優先度の理由**: 従業員情報の編集と契約情報の編集を分離することで、誤操作を防ぎ、データの整合性を保つことができます。基本情報のみを編集できるようにすることで、契約関連の情報が誤って変更されることを防ぎます。契約番号の管理により、勤務条件、雇用契約、書類・提出状況を1つの契約として統合管理できます。

**独立テスト**: 統括人事管理者が従業員管理ページから「従業員情報を編集」画面を開き、基本情報のみが編集可能で、勤務条件、雇用契約、書類・提出状況のウィジェットが表示のみであることを確認します。また、契約番号を入力・管理できることを確認します。

**受け入れシナリオ**:

1. **Given** 統括人事管理者が従業員管理ページから「従業員情報を編集」画面を開いている, **When** 基本情報ウィジェットを確認する, **Then** 基本情報が編集可能である
2. **Given** 統括人事管理者が従業員管理ページから「従業員情報を編集」画面を開いている, **When** 勤務条件ウィジェットを確認する, **Then** 勤務条件の情報が表示されるが編集できない
3. **Given** 統括人事管理者が従業員管理ページから「従業員情報を編集」画面を開いている, **When** 雇用契約ウィジェットを確認する, **Then** 雇用契約の情報が表示されるが編集できない
4. **Given** 統括人事管理者が従業員管理ページから「従業員情報を編集」画面を開いている, **When** 書類・提出状況ウィジェットを確認する, **Then** 書類・提出状況の情報が表示されるが編集できない
5. **Given** 統括人事管理者が従業員管理ページから「従業員情報を編集」画面で基本情報を変更する, **When** 変更内容を保存する, **Then** 基本情報が正しく更新される
6. **Given** 統括人事管理者が従業員管理ページから「従業員情報を編集」画面を開いている, **When** 勤務条件、雇用契約、書類・提出状況のウィジェットを確認する, **Then** 契約番号の入力欄が表示される
7. **Given** 統括人事管理者が従業員管理ページから「従業員情報を編集」画面で契約番号を入力する, **When** 契約番号を入力して保存する, **Then** 契約番号が正しく保存され、勤務条件、雇用契約、書類・提出状況がその契約番号で管理される

---

### User Story 7 - 契約履歴への自動追記 (Priority: P1)

新しい契約が作成されたり、契約が更新された場合、employment_historyテーブルに登録された契約番号ごとに、勤務条件、雇用契約、書類・提出状況が自動的に保存される。勤務条件、雇用契約、書類・提出状況は1つの契約番号で管理され、その契約番号に関連するすべての情報がemployment_historyテーブルに記録される。

**優先度の理由**: 契約の変更履歴を正確に記録することは、監査や法的要件の遵守のために重要です。契約の作成・更新時に自動的に履歴が記録されることで、手動での記録漏れを防ぎます。契約番号ごとに勤務条件、雇用契約、書類・提出状況を統合して保存することで、契約の完全な履歴を追跡できます。

**独立テスト**: 統括人事管理者が新規契約を作成し、契約番号とともに勤務条件、雇用契約、書類・提出状況を入力して保存した後、employment_historyテーブルに新しいレコードが作成され、契約番号に関連するすべての情報（勤務条件、雇用契約、書類・提出状況）が記録されることを確認します。契約を更新した場合も、同様に履歴が追記されることを検証できます。

**受け入れシナリオ**:

1. **Given** 統括人事管理者が新規契約を作成する, **When** 契約番号とともに勤務条件、雇用契約、書類・提出状況の情報を入力して保存する, **Then** employment_historyテーブルに新しいレコードが作成され、契約番号とその契約番号に関連する勤務条件、雇用契約、書類・提出状況が記録される
2. **Given** 統括人事管理者が既存の契約を更新する, **When** 契約番号に関連する勤務条件、雇用契約、書類・提出状況の情報を変更して保存する, **Then** employment_historyテーブルに新しいレコードが作成され、更新後の契約番号とその契約番号に関連する勤務条件、雇用契約、書類・提出状況が記録される
3. **Given** 統括人事管理者が従業員の契約履歴を表示する, **When** 契約履歴タブを確認する, **Then** 新規作成・更新された契約の情報（契約番号、勤務条件、雇用契約、書類・提出状況）が時系列で表示される
4. **Given** 統括人事管理者が複数の契約番号を持つ従業員の履歴を表示する, **When** 契約履歴タブを確認する, **Then** 各契約番号ごとに、その契約番号に関連する勤務条件、雇用契約、書類・提出状況が正しく表示される

---

### User Story 8 - 従業員管理画面での契約情報の表示制御 (Priority: P1)

統括人事管理者または現場マネージャーが従業員管理画面を表示した際、新しい契約の雇用期間開始日時になるまでは現行の勤務情報、給与・手当情報、書類情報が表示され、雇用期間開始日を超えた場合は新しい契約内容が反映される。

**優先度の理由**: 従業員管理画面で表示される情報の正確性は重要です。契約の開始日時を基準に情報を切り替えることで、ユーザーは常に有効な契約情報を確認できます。

**独立テスト**: 統括人事管理者が従業員管理画面を表示し、新しい契約が登録されているが雇用期間開始日時が未来の場合、現行の契約情報が表示されることを確認します。雇用期間開始日を過ぎた後、新しい契約内容が表示されることを検証できます。

**受け入れシナリオ**:

1. **Given** 従業員に新しい契約が登録されているが、雇用期間開始日（contract_start_date）が未来の日付である, **When** 統括人事管理者が従業員管理画面の詳細ページを表示する, **Then** 勤務情報、給与・手当、書類、備考の各タブに現行の契約情報が表示される
2. **Given** 従業員に新しい契約が登録されており、雇用期間開始日（contract_start_date）が当日または過去の日付である, **When** 統括人事管理者が従業員管理画面の詳細ページを表示する, **Then** 勤務情報、給与・手当、書類、備考の各タブに新しい契約の情報が表示される
3. **Given** 従業員に複数の契約が登録されている, **When** 統括人事管理者が従業員管理画面の詳細ページを表示する, **Then** 現在有効な契約（雇用期間開始日が当日または過去で、最も新しい契約）の情報が表示される
4. **Given** 従業員に有効な契約が存在しない, **When** 統括人事管理者が従業員管理画面の詳細ページを表示する, **Then** 勤務情報、給与・手当、書類、備考の各タブに「契約情報なし」または空の状態が表示される

---

### User Story 9 - ダッシュボードの重要タスク優先度表示と統計カード (Priority: P1)

統括人事管理者がダッシュボードの「本日の重要タスク」一覧を表示した際、各タスクのステータスが「要更新」の場合は赤色で表示され、優先度が正しく設定されている。また、3つの統計カード（従業員数、今月の契約処理、契約更新予定）が表示される。

**優先度の理由**: ダッシュボードはユーザーが最初に目にする画面であり、重要なタスクを視覚的に識別できることが重要です。ステータスの色分けと優先度の設定により、ユーザーは緊急度の高いタスクを素早く識別し、効率的に作業を進められます。

**独立テスト**: 統括人事管理者がダッシュボードを表示し、「本日の重要タスク」一覧で「要更新」ステータスのタスクが赤色で表示され、優先度が「高」に設定されていることを確認します。契約残り日数に応じて優先度が「中」または「低」に設定されていることも検証できます。また、3つの統計カードが正しく表示されることも検証できます。

**受け入れシナリオ**:

1. **Given** 統括人事管理者がダッシュボードを表示している, **When** 「本日の重要タスク」一覧を確認する, **Then** ステータスが「要更新」のタスクが赤色で表示される
2. **Given** 統括人事管理者がダッシュボードを表示している, **When** ステータスが「要更新」のタスクを確認する, **Then** そのタスクの優先度が「高」に設定されている
3. **Given** 統括人事管理者がダッシュボードを表示している, **When** 契約が60日以上90日未満残っている従業員のタスクを確認する, **Then** そのタスクの優先度が「中」に設定されている
4. **Given** 統括人事管理者がダッシュボードを表示している, **When** 契約が90日以上残っている従業員のタスクを確認する, **Then** そのタスクの優先度が「低」に設定されている
5. **Given** 統括人事管理者がダッシュボードを表示している, **When** 統計カードセクションを確認する, **Then** 「従業員数」「今月の契約処理」「契約更新予定」の3つのカードが表示される
6. **Given** 統括人事管理者がダッシュボードを表示している, **When** 「従業員数」カードを確認する, **Then** 現在の従業員総数が表示される
7. **Given** 統括人事管理者がダッシュボードを表示している, **When** 「今月の契約処理」カードを確認する, **Then** 今月（当月）に処理された契約の件数が表示される
8. **Given** 統括人事管理者がダッシュボードを表示している, **When** 「契約更新予定」カードを確認する, **Then** 今後30日以内に更新予定の契約件数が表示される

---

### User Story 10 - 給与計算用データの抽出 (Priority: P1)

統括人事管理者が給与計算に必要なデータ（時給、通勤費、社会保険フラグ、各種手当）をCSV形式で抽出できる。

**優先度の理由**: 給与支払データ作成の効率化という主要目的を達成するための核心機能です。手入力作業を削減し、正確性を向上させるために必須です。

**独立テスト**: 統括人事管理者が指定した日時点での給与計算用データをCSV形式で抽出できることを確認します。抽出されたCSVに時給、通勤費、社会保険フラグ、各種手当が含まれていることを検証できます。

**受け入れシナリオ**:

1. **Given** 従業員情報と給与情報が登録されている, **When** 給与計算用CSVを抽出する, **Then** 時給情報（複数レート対応、適用期間付き）、残業時給、通勤費（ルート別）、社会保険加入フラグ、各種手当が含まれたCSVが生成される
2. **Given** 複数の従業員が登録されている, **When** 指定日時点での給与計算用CSVを抽出する, **Then** その時点で有効な情報のみが抽出される
3. **Given** 抽出項目を選択できる, **When** 必要な項目のみを選択してCSV抽出する, **Then** 選択した項目のみが含まれたCSVが生成される

---

### User Story 10-1 - 契約書・誓約書の一括ダウンロード・一括印刷 (Priority: P1)

統括人事管理者が契約管理ページで、チェックボックスにチェックの付いた契約を選択し、「一括ダウンロード」ボタンまたは「一括印刷」ボタンをクリックすることで、選択した契約の契約書または誓約書を一括処理できる。

**優先度の理由**: 複数の契約書や誓約書を一度に処理することで、作業効率が大幅に向上します。個別にダウンロードや印刷を行う必要がなくなり、時間を節約できます。

**独立テスト**: 統括人事管理者が契約管理ページで複数の契約にチェックを入れ、「一括ダウンロード」ボタンをクリックした場合、選択した契約の契約書が一括でダウンロードされることを確認します。同様に「一括印刷」ボタンをクリックした場合、選択した契約の契約書が一括で印刷されることを検証できます。

**受け入れシナリオ**:

1. **Given** 統括人事管理者が契約管理ページを表示している, **When** 「CSV/給与データ抽出」ボタンの左側を確認する, **Then** 「一括ダウンロード」ボタンと「一括印刷」ボタンが表示される
2. **Given** 統括人事管理者が契約管理ページで複数の契約にチェックを入れる, **When** 「一括ダウンロード」ボタンをクリックする, **Then** 選択した契約の契約書がPDF形式で一括ダウンロードされる
3. **Given** 統括人事管理者が契約管理ページで複数の契約にチェックを入れる, **When** 「一括印刷」ボタンをクリックする, **Then** 選択した契約の契約書が一括で印刷される
4. **Given** 統括人事管理者が契約管理ページで契約にチェックを入れていない, **When** 「一括ダウンロード」ボタンまたは「一括印刷」ボタンをクリックしようとする, **Then** ボタンが無効化されているか、エラーメッセージが表示される
5. **Given** 統括人事管理者が契約管理ページで複数の契約にチェックを入れる, **When** 「一括ダウンロード」ボタンをクリックして契約書と誓約書のどちらをダウンロードするか選択する, **Then** 選択した種類の書類が一括ダウンロードされる

---

### User Story 11 - 契約更新アラート機能 (Priority: P2)

契約期限が近づいた際に、統括人事管理者と現場マネージャーに自動通知が送られる。

**優先度の理由**: 契約更新の見逃しを防ぎ、継続的な雇用管理を支援する重要な機能です。ただし、基本機能が動作した後に実装することで、段階的に価値を提供できます。

**独立テスト**: 契約期限の30日前、14日前、7日前に自動通知が送られることを確認します。通知対象者が正しく設定され、アラート状態が管理されることを検証できます。

**受け入れシナリオ**:

1. **Given** 契約期限が30日前になった, **When** アラートシステムが動作する, **Then** 統括人事管理者と担当部署の現場マネージャーに通知が送られる
2. **Given** 契約期限が14日前になった, **When** アラートシステムが動作する, **Then** リマインダー通知が送られる
3. **Given** 契約期限が7日前になった, **When** アラートシステムが動作する, **Then** 最終リマインダー通知が送られる
4. **Given** 契約書が出力された, **When** 雇用終了アラートが設定されている, **Then** アラートが自動解除される

---

### User Story 12 - 従業員検索と一覧表示 (Priority: P2)

統括人事管理者と現場マネージャーが従業員を検索し、一覧表示できる。勤務場所やステータスでフィルタリング可能。

**優先度の理由**: 登録された従業員情報を効率的に閲覧・管理するための基本機能です。検索とフィルタリングにより、大量のデータから必要な情報を素早く見つけられます。

**独立テスト**: ユーザーが従業員を検索し、勤務場所やステータスでフィルタリングして一覧表示できることを確認します。検索結果が正しく表示され、権限に応じた情報のみが表示されることを検証できます。

**受け入れシナリオ**:

1. **Given** 複数の従業員が登録されている, **When** 氏名で検索する, **Then** 該当する従業員が一覧に表示される
2. **Given** 複数の従業員が登録されている, **When** 勤務場所でフィルタリングする, **Then** 該当する勤務場所の従業員のみが表示される
3. **Given** 現場マネージャーがログインしている, **When** 従業員一覧を表示する, **Then** 自部門・自拠点の従業員のみが表示される
4. **Given** 統括人事管理者がログインしている, **When** 従業員一覧を表示する, **Then** すべての従業員が表示される
5. **Given** 複数の従業員が一覧に表示されている, **When** 複数の従業員をチェックしてステータスを一括変更する, **Then** 選択した従業員のステータスが一括で更新される

---

### User Story 13 - 同時編集制御 (Priority: P2)

複数のユーザーが同じ従業員情報を同時に編集しようとした場合、最初のアクセス者以外は編集できない。

**優先度の理由**: データの整合性を保ち、同時編集による競合を防ぐ重要な機能です。ただし、基本機能が動作した後に実装することで、段階的に価値を提供できます。

**独立テスト**: 2人のユーザーが同じ従業員情報に同時にアクセスし、最初のユーザーが編集を開始した場合、2人目のユーザーは編集できないことを確認します。ロックが15分後に自動解放されることも検証できます。

**受け入れシナリオ**:

1. **Given** ユーザーAが従業員情報を編集している, **When** ユーザーBが同じ従業員情報にアクセスする, **Then** ユーザーBは編集できないことを示すメッセージが表示される
2. **Given** ユーザーAが従業員情報の編集を開始した, **When** 15分が経過する, **Then** ロックが自動解放され、他のユーザーが編集可能になる
3. **Given** ユーザーAが従業員情報の編集を保存した, **When** 保存が完了する, **Then** ロックが解放され、他のユーザーが編集可能になる

---

### User Story 14 - 契約履歴の管理と表示 (Priority: P3)

従業員の契約履歴（雇用期間、勤務時間、勤務日数、勤務場所、時給、雇用保険、社会保険）を表示できる。

**優先度の理由**: 過去の契約情報を参照するための機能です。基本機能が動作した後に実装することで、段階的に価値を提供できます。

**独立テスト**: 統括人事管理者が従業員の契約履歴を表示できることを確認します。過去の契約情報が時系列で表示され、必要な情報がすべて含まれていることを検証できます。

**受け入れシナリオ**:

1. **Given** 従業員に複数の契約履歴がある, **When** 契約履歴を表示する, **Then** 雇用期間、勤務時間、勤務日数、勤務場所、時給、雇用保険、社会保険が時系列で表示される
2. **Given** 契約内容が変更された, **When** 契約変更履歴を表示する, **Then** 変更日時、変更項目、変更前値、変更後値、変更理由、更新者、承認者が表示される

---

### エッジケース

- 複数のユーザーが同時に同じ従業員情報にアクセスした場合、最初のアクセス者以外は編集できない
- 契約書を再作成する際、既存の承認番号をそのまま使用しようとした場合、新しい承認番号の入力が必須となる
- 契約書.pdfのフォーマットで、データベースに存在しない情報（例：承認番号など）を入力する場合、手動入力が必要となる
- 誓約書.pdfのフォーマットで、社員番号がデータベースに存在しない場合、エラーメッセージを表示し、PDF出力を中止する
- 契約書プレビューまたは誓約書プレビューを表示する際、データベースに必要な情報が不足している場合、エラーメッセージを表示すること
- 一括ダウンロードまたは一括印刷を実行する際、選択した契約のうち一部の契約でデータが不足している場合、エラーメッセージを表示し、処理可能な契約のみを処理すること
- 給与計算用CSV抽出時に、適用期間が重複する時給レートがある場合、最新のレートが優先される
- 契約更新アラートが送信された後、契約が更新されずに期限が過ぎた場合、アラート状態が「確認済」に更新される
- 従業員情報を削除しようとした場合、関連する契約履歴や提出物・預かり品の情報も連鎖的に削除される
- 検索結果が100件を超える場合、ページネーションが適用され、効率的に閲覧できる
- 権限のないユーザーが個人番号や給与情報にアクセスしようとした場合、アクセスが拒否される
- Enterキーを押下した場合、保存されずに次のフィールドに移動する（誤操作防止）
- 従業員番号を手動入力する際、既存の従業員番号と重複する場合、エラーメッセージが表示され登録が拒否される
- 契約満了予定日が当日（00:00:00）の場合、「要更新」は表示されない（当日を過ぎた時点で表示）
- 複数の契約を持つ従業員で、一部の契約のみが契約満了予定日を過ぎている場合、従業員管理ページでは「要更新」が表示される（少なくとも1つの契約が満了予定日を過ぎている場合）
- 契約が60日未満残っているが「要更新」ステータスでない場合、優先度は「高」とする（契約残り日数が少ないため）
- 契約がちょうど60日残っている場合、優先度は「中」とする（60日以上に該当）
- 契約がちょうど90日残っている場合、優先度は「低」とする（90日以上に該当）
- 契約満了予定日が設定されていない（NULL）場合、優先度の判定方法（「要更新」ステータスがある場合は「高」、ない場合は「中」とする）
- 複数の契約を持つ従業員の場合、最も近い契約満了予定日を基準に優先度を判定する
- 契約削除時に、既に雇用期間開始日を過ぎている契約を削除しようとした場合、警告メッセージを表示し、削除を確認する
- 複数の契約が同じ雇用期間開始日を持つ場合、契約作成日時が新しい契約を優先して表示する
- 契約更新時に、既存のwork_conditionsレコードを更新するか、新しいレコードを作成するかの判断（有効期間による判定）

## 明確化事項

### Session 2025-01-27

- Q: 従業員番号の生成方法と一意性管理 → A: 手動入力（ユーザーが入力、システムが一意性チェック）
- Q: エラー状態とエラーメッセージの表示方法 → A: インライン表示（エラーが発生したフィールドの直下にメッセージを表示）
- Q: 契約更新アラートの通知配信方法 → A: システム内通知のみ（アプリケーション内の通知センターに表示）
- Q: 監査ログの保持期間 → A: 7年間（法的要件に準拠）
- Q: 従業員データの保持期間（退職後） → A: 7年間（法的要件に準拠）

### Session 2025-01-28

- Q: 雇用開始日と雇用終了日のUI配置 → A: 近い場所に配置する（UI-001として要件化）
- Q: 役職・雇用形態の必要性 → A: 不要（Out of Scopeに明記、Employment Historyエンティティから除外）
- Q: 残業時給の必要性 → A: 必要（従業員管理情報.mdに記載、給与・手当タブに表示）
- Q: 一覧画面からのステータス一括変更 → A: 必要（FR-026として要件化、User Story 5にAcceptance Scenario追加）
- Q: 銀行口座情報の保存 → A: 不要（Out of Scopeに明記、Assumptionsにも追記）
- Q: 連絡先情報の保存 → A: 統括としては不要、現場での必要性は検討中（Assumptionsに追記、Out of Scopeにも明記）
- Q: データベースの部門項目で登録する部門 → A: `部門情報.md`に記載されている4つの項目（BPS課、オンサイト課、CC課、PS課）（EmployeeエンティティとEmployment Historyエンティティに反映、FR-001に追加、依存関係に追加）

### Session 2025-01-28 (Update)

- 編集権限制御の追加: 従業員管理ページから「従業員情報を編集」画面を開いた場合は基本情報のみ編集可能、勤務条件・雇用契約・書類・提出状況は表示のみ（User Story 6-1、FR-082、UI-021として要件化）
- 契約画面の編集権限制御: 契約管理ページから「契約更新」または「新規契約作成」画面を開いた場合は基本情報は表示のみ、勤務条件・雇用契約・書類・提出状況は編集可能（User Story 6更新、FR-083、UI-022として要件化）
- 統合ウィジェットの追加: 「契約更新」および「新規契約作成」画面で、勤務条件・雇用契約・書類・提出状況を1つの大きなウィジェットとして統合し、先頭に契約番号入力欄を配置（FR-084、FR-085、FR-086、UI-023、UI-024として要件化）
- 契約番号管理の追加: 勤務条件、雇用契約、書類・提出状況は1つの契約番号で管理され、「従業員情報を編集」ページで契約番号を入力・管理できる（User Story 6-1更新、FR-087、UI-026として要件化）
- 契約書・誓約書出力仕様の詳細化: 契約書.pdfと誓約書.pdfを使用し、契約書はデータベースの登録情報から特定項目を自動入力、誓約書は社員番号のみを自動入力（User Story 2更新、FR-006-1、FR-006-2、SC-002-1、SC-002-2として要件化）
- プレビュー機能の追加: 契約管理ページの操作メニューに「契約書プレビュー」と「誓約書プレビュー」を追加し、ポップアップで表示、ダウンロード・印刷機能を提供（User Story 5更新、FR-088、FR-089、FR-090、UI-027、UI-028、UI-029として要件化）
- 一括ダウンロード・一括印刷機能の追加: 契約管理ページに「一括ダウンロード」ボタンと「一括印刷」ボタンを追加し、チェックボックスで選択した契約を一括処理（User Story 10-1、FR-091、FR-092、FR-093、UI-030、UI-031として要件化）
- employment_historyテーブルへの保存仕様の明確化: 登録された契約番号ごとに、勤務条件、雇用契約、書類・提出状況をemployment_historyテーブルに保存する（User Story 7更新、FR-065、FR-066、SC-036、SC-037、Employment Historyエンティティ更新として要件化）

## 要件 *(必須)*

### 機能要件

- **FR-001**: システムは統括人事管理者が新規従業員を基本情報（従業員番号は手動入力、氏名、生年月日、入社日、雇用区分、部門コード）で登録できること。システムは従業員番号の一意性を検証し、重複エントリを拒否し、エラーメッセージを従業員番号フィールドの直下にインライン表示すること。部門コードは`部門情報.md`に記載されている4つの項目（BPS課、オンサイト課、CC課、PS課）のいずれかから選択すること。
- **FR-002**: システムは各従業員に対して複数の勤務時間（時間帯）を設定できること。勤務時間帯はJSONBカラム（working_hours_jsonb）に配列形式で格納される。
- **FR-003**: システムは各従業員に対して複数の休憩時間（時間帯）を設定できること。休憩時間帯はJSONBカラム（break_hours_jsonb）に配列形式で格納される。
- **FR-004**: システムは各従業員に対して複数の勤務場所を設定できること。勤務場所はJSONBカラム（work_locations_jsonb）に配列形式で格納される。
- **FR-005**: システムはルート別に交通費（往復金額、月額定期、上限金額、最寄り駅）を登録できること。交通費情報はJSONBカラム（transportation_routes_jsonb）に配列形式で格納される。
- **FR-006**: システムは雇用契約書をPDF形式で生成し、自動的に枝番を付与すること。
- **FR-006-1**: システムは契約書.pdfを元にしたフォーマットを使用して契約書をPDF形式で生成すること。データベースの登録情報から以下の項目を自動入力すること：契約者の氏名（**殿の部分）、右上の契約書の作成年月日、雇用期間（期間の定めアリの部分と赤字の基準日）、就業の場所（赤字部分）、業務の内容（赤字部分）、勤務日、社会保険加入、休暇（赤字部分）、賃金（赤字部分）。
- **FR-006-2**: システムは誓約書.pdfを元にしたフォーマットを使用して誓約書をPDF形式で生成すること。社員番号のみをデータベースから取得し、フォーマットに入力し、その他の部分はそのままPDFで出力すること。
- **FR-007**: システムは雇用契約書を作成または再作成する際に承認番号の入力を必須とすること。
- **FR-008**: システムは給与計算用データ（時給、残業時給、通勤費、社会保険フラグ、各種手当）をCSV形式で抽出できること。
- **FR-009**: システムは指定した時点でのデータをCSV形式で抽出でき、出力項目を選択可能にすること。
- **FR-010**: システムは契約期限の30日前、14日前、7日前に自動アラートを送信すること。アラートはアプリケーション内の通知センターのみで配信し（メールやSMSは使用しない）、ユーザーはアプリケーション内でアラートを閲覧・管理できること。
- **FR-011**: システムは最初のアクセス者以外が同じ従業員レコードを同時に編集することを防止すること。
- **FR-012**: システムはすべての画面に最終更新日時と更新者を表示すること。
- **FR-013**: システムはすべての契約変更（変更日時、変更項目、変更前値、変更後値、変更理由、更新者、承認者）を記録すること。
- **FR-014**: システムは従業員を氏名、勤務場所、ステータスで検索できること。
- **FR-015**: システムは個人番号と給与情報（時給、残業時給を含む）へのアクセスを統括人事管理者と管理者のみに制限すること。
- **FR-016**: システムは現場マネージャーのアクセスを自部門・自拠点のデータのみに制限すること。
- **FR-017**: システムはCSV抽出、契約書PDF出力、給与CSV出力を統括人事管理者と管理者のみに制限すること。
- **FR-018**: システムはすべての変更操作を監査ログに記録すること（変更前値・変更後値をJSON形式で）。監査ログは法的要件（労働関係書類の保存期間）に準拠して7年間保持すること。
- **FR-019**: システムはEnterキーが押下された場合に保存せず、次のフィールドに移動すること。
- **FR-020**: システムは編集ロックを15分後に自動解放すること。
- **FR-021**: システムは書類提出・預かり品を管理できること（提出ステータス、返却ステータスの追跡）。管理対象の書類は雇用契約書、雇用保険被保険者証、年金手帳、健康保険証、退職届、セキュリティカード等を含む。
- **FR-022**: システムは契約履歴を表示できること（雇用期間、勤務時間、勤務日数、勤務場所、時給、雇用保険、社会保険）。
- **FR-023**: システムは契約内容が変更された場合、既存の契約を無効化し、新しい契約書の作成を必須とすること。
- **FR-024**: システムは契約書が出力された場合、雇用終了アラートを自動解除すること。
- **FR-025**: システムはバリデーションエラーをインライン表示（エラーが発生したフィールドの直下）し、明確でユーザーフレンドリーな日本語のエラーメッセージを表示すること。
- **FR-026**: システムは従業員一覧画面から複数選択した従業員の書類ステータスを更新できること。
- **FR-027**: システムは契約（Contract）エンティティに「雇用満了予定日」（employment_expiry_scheduled_date）フィールドを追加すること。このフィールドは契約開始日（contract_start_date）と組み合わせて雇用期間を管理するために使用される。
- **FR-028**: システムは契約（Contract）エンティティに「雇用満了日」（employment_expiry_date）フィールドを追加すること。このフィールドは実際の雇用終了日を記録するために使用され、任意項目とする。
- **FR-029**: システムは雇用期間を「契約開始日〜雇用満了予定日」として表示すること。実際の雇用満了日が設定されている場合、それも併せて表示すること。
- **FR-030**: システムは契約更新アラートを雇用満了予定日に基づいて送信すること。実際の雇用満了日が設定されていても、予定日ベースでアラートが動作すること。
- **FR-031**: システムは雇用満了予定日が契約開始日より後の日付であることを検証すること。
- **FR-032**: システムは実際の雇用満了日が契約開始日より後の日付であることを検証すること（設定されている場合）。
- **FR-033**: システムは契約履歴表示で、契約開始日、雇用満了予定日、実際の雇用満了日を表示すること。
- **FR-034**: システムは雇用満了予定日を変更した場合、契約更新アラートを再計算すること。
- **FR-035**: システムは勤務条件（Work Condition）エンティティに、複数の勤務時間帯、休憩時間帯、勤務場所、交通費情報を統合された構造で保存できること。`work_conditions`テーブルにJSONBカラム（`working_hours_jsonb`、`break_hours_jsonb`、`work_locations_jsonb`、`transportation_routes_jsonb`）を追加し、物理的に1つのテーブルに統合すること。
- **FR-036**: システムは統合構造でも、1つの勤務条件に対して複数の勤務時間帯を設定できること。各勤務時間帯は開始時刻と終了時刻を含むこと。
- **FR-037**: システムは統合構造でも、1つの勤務条件に対して複数の休憩時間帯を設定できること。各休憩時間帯は開始時刻と終了時刻を含むこと。休憩時間帯は任意項目とすること。
- **FR-038**: システムは統合構造でも、1つの勤務条件に対して複数の勤務場所を設定できること。各勤務場所は場所名を含むこと。
- **FR-039**: システムは統合構造でも、1つの勤務条件に対して複数の交通費情報を設定できること。各交通費情報はルート名、往復金額、月額定期、上限金額、最寄り駅を含むこと。交通費情報は任意項目とすること。
- **FR-040**: システムは統合構造でも、勤務時間帯の重複を検証すること。同じ勤務条件内で、勤務時間帯が重複している場合、バリデーションエラーを表示すること。
- **FR-041**: システムは統合構造でも、休憩時間帯が勤務時間帯の範囲内であることを検証すること。範囲外の休憩時間帯が設定されている場合、バリデーションエラーを表示すること。
- **FR-042**: システムは統合構造でも、少なくとも1つの勤務時間帯と1つの勤務場所が設定されていることを検証すること。これらが設定されていない場合、バリデーションエラーを表示すること。
- **FR-043**: システムは契約管理画面で、契約満了予定日（employment_expiry_scheduled_date）が当日の日付を過ぎている契約に「要更新」の表示をすること。
- **FR-044**: システムは従業員詳細ページで、その従業員に関連する契約のうち、契約満了予定日が当日の日付を過ぎている契約に「要更新」の表示をすること。
- **FR-045**: システムは従業員管理ページ（一覧ページ）で、契約満了予定日が当日の日付を過ぎている契約を持つ従業員に「要更新」の表示をすること。
- **FR-046**: システムは「要更新」の判定を、契約満了予定日（employment_expiry_scheduled_date）が当日の日付（00:00:00）より前の日付である場合に行うこと。当日の日付は「要更新」の対象としないこと。
- **FR-047**: システムは契約満了予定日が設定されていない（NULL）契約に対しては「要更新」の表示をしないこと。
- **FR-048**: システムは「要更新」の表示が視覚的に識別しやすい形式（例：バッジ、ラベル、色分けなど）で行うこと。
- **FR-049**: システムは「要更新」の表示がされている契約または従業員をクリックした場合、適切な詳細画面に遷移できること。
- **FR-050**: システムは従業員登録・編集画面の雇用区分選択肢で、「常勤」「パートタイム」「契約社員」の3つのラベルを表示すること。データベースの値（FULL_TIME, PART_TIME, CONTRACT）との対応は以下の通りとする：
  - FULL_TIME → 「常勤」
  - PART_TIME → 「パートタイム」
  - CONTRACT → 「契約社員」
- **FR-051**: システムは従業員一覧画面で、各従業員の雇用区分を「常勤」「パートタイム」「契約社員」のいずれかで表示すること。
- **FR-052**: システムは従業員詳細画面で、従業員の雇用区分を「常勤」「パートタイム」「契約社員」のいずれかで表示すること。
- **FR-053**: システムは雇用区分のフィルタリング機能（一覧画面での検索・フィルタ）が、データベースの値（FULL_TIME, PART_TIME, CONTRACT）を基準に動作し続けること（表示ラベルの変更の影響を受けないこと）。
- **FR-054**: システムはCSVエクスポート機能で、データベースの値（FULL_TIME, PART_TIME, CONTRACT）を出力すること（表示ラベルの変更の影響を受けないこと）。
- **FR-055**: システムは既存のAPIレスポンスで、データベースの値（FULL_TIME, PART_TIME, CONTRACT）を返すこと（表示ラベルの変更の影響を受けないこと）。
- **FR-056**: システムはデータベースに保存されている雇用区分の値（FULL_TIME, PART_TIME, CONTRACT）を変更しないこと。
- **FR-057**: システムは契約管理画面の一覧表示で、アラート列の右側に操作列を追加し、各契約行に3点メニューアイコンを表示すること。
- **FR-058**: システムは3点メニューアイコンをクリックした際、ポップアップメニューを表示し、「契約プレビュー」「契約更新」「新規契約作成」「契約削除」の4つのメニュー項目を表示すること。
- **FR-059**: システムは「契約プレビュー」メニューを選択した際、契約のプレビュー画面を表示すること。
- **FR-060**: システムは「契約更新」メニューを選択した際、契約更新画面を表示すること。
- **FR-061**: システムは「新規契約作成」メニューを選択した際、新規契約作成画面を表示すること。
- **FR-062**: システムは「契約削除」メニューを選択した際、削除確認ダイアログを表示し、確認後に契約を削除すること。
- **FR-063**: システムは契約の新規作成・更新画面で、contractsテーブルの情報（契約種別、契約開始日、雇用満了予定日、時給、残業時給、業務内容、有給休暇条項など）を入力・表示できること。
- **FR-064**: システムは契約の新規作成・更新画面で、work_conditionsテーブルの情報（勤務時間帯、休憩時間帯、勤務場所、交通費情報、勤務日数タイプ、勤務日数など）を入力・表示できること。
- **FR-065**: システムは新しい契約が作成された場合、employment_historyテーブルに新しいレコードを作成し、登録された契約番号ごとに、その契約番号に関連する勤務条件、雇用契約、書類・提出状況を記録すること。
- **FR-066**: システムは契約が更新された場合、employment_historyテーブルに新しいレコードを作成し、更新後の契約番号ごとに、その契約番号に関連する勤務条件、雇用契約、書類・提出状況を記録すること。
- **FR-067**: システムは従業員管理画面の詳細ページで、新しい契約の雇用期間開始日（contract_start_date）が当日または過去の日付である場合、新しい契約の情報を表示すること。
- **FR-068**: システムは従業員管理画面の詳細ページで、新しい契約の雇用期間開始日（contract_start_date）が未来の日付である場合、現行の契約情報を表示すること。
- **FR-069**: システムは従業員管理画面の詳細ページで、複数の契約が存在する場合、現在有効な契約（雇用期間開始日が当日または過去で、最も新しい契約）の情報を表示すること。
- **FR-070**: システムは従業員管理画面の詳細ページの勤務情報タブで、有効な契約のwork_conditions情報を表示すること。
- **FR-071**: システムは従業員管理画面の詳細ページの給与・手当タブで、有効な契約のcontracts情報（時給、残業時給など）とwork_conditions情報（交通費など）を表示すること。
- **FR-072**: システムは従業員管理画面の詳細ページの書類タブで、有効な契約に関連する書類情報を表示すること。
- **FR-073**: システムは従業員管理画面の詳細ページの備考タブで、有効な契約に関連する備考情報を表示すること。
- **FR-074**: システムはダッシュボードの「本日の重要タスク」一覧で、ステータスが「要更新」のタスクを赤色で表示すること。
- **FR-075**: システムは「本日の重要タスク」一覧で、各タスクの優先度を以下のルールに基づいて設定すること：
  - ステータスが「要更新」の場合、優先度を「高」とする
  - 契約が90日以上残っている場合、優先度を「低」とする
  - 契約が60日以上90日未満残っている場合、優先度を「中」とする
  - 契約が60日未満残っている場合、優先度を「高」とする
- **FR-076**: システムは「本日の重要タスク」一覧で、優先度に基づいてタスクをソートし、優先度「高」を最上部に表示すること。
- **FR-077**: システムはダッシュボードに3つの統計カードを表示すること：
  - 「従業員数」カード：現在の従業員総数を表示
  - 「今月の契約処理」カード：今月（当月）に処理された契約の件数を表示（契約の作成と更新をカウント）
  - 「契約更新予定」カード：今後30日以内に更新予定の契約件数を表示
- **FR-078**: システムは各統計カードをクリックした際、該当する詳細画面（従業員一覧、契約一覧など）に遷移できること。
- **FR-079**: システムは契約残り日数の計算を、契約満了予定日（employment_expiry_scheduled_date）から当日の日付を引いた日数で行うこと。
- **FR-080**: システムは複数の契約を持つ従業員の場合、最も近い契約満了予定日を基準に優先度を判定すること。
- **FR-081**: システムは契約満了予定日が設定されていない（NULL）場合、優先度の判定において「要更新」ステータスがある場合は「高」、ない場合は「中」とすること。
- **FR-082**: システムは従業員管理ページから「従業員情報を編集」画面を開いた場合、基本情報のウィジェットのみが編集可能で、勤務条件、雇用契約、書類・提出状況のウィジェットは表示のみとすること。
- **FR-083**: システムは契約管理ページから「契約更新」または「新規契約作成」画面を開いた場合、基本情報のウィジェットは表示のみとし、勤務条件、雇用契約、書類・提出状況の各ウィジェットが編集可能であること。
- **FR-084**: システムは「契約更新」または「新規契約作成」画面で、勤務条件セクション、雇用契約セクション、書類・提出状況セクションを1つの大きなウィジェットとして統合表示すること。
- **FR-085**: システムは統合されたウィジェットの先頭に契約番号を入力できる記入欄を配置すること。
- **FR-086**: システムは契約番号の入力欄で、新規契約作成時には新規の契約番号を入力でき、契約更新時には既存の契約番号を表示し、必要に応じて変更できること。
- **FR-087**: システムは従業員管理ページから「従業員情報を編集」画面を開いた場合、勤務条件、雇用契約、書類・提出状況のウィジェットに対して契約番号を入力・管理できること。これらのウィジェットは1つの契約番号で管理されること。
- **FR-088**: システムは契約管理ページの操作メニューに「契約書プレビュー」と「誓約書プレビュー」のメニュー項目を追加すること。
- **FR-089**: システムは「契約書プレビュー」または「誓約書プレビュー」を選択した際、ポップアップで書類の内容を表示すること。
- **FR-090**: システムはプレビューポップアップにダウンロード機能と印刷機能を提供すること。
- **FR-091**: システムは契約管理ページの「CSV/給与データ抽出」ボタンの左に「一括ダウンロード」ボタンと「一括印刷」ボタンを配置すること。
- **FR-092**: システムはチェックボックスにチェックの付いた契約を選択し、「一括ダウンロード」ボタンをクリックした際、選択した契約の契約書または誓約書を一括でダウンロードできること。
- **FR-093**: システムはチェックボックスにチェックの付いた契約を選択し、「一括印刷」ボタンをクリックした際、選択した契約の契約書または誓約書を一括で印刷できること。

### 主要エンティティ *(データを含む機能の場合に含める)*

- **従業員（Employee）**: パート従業員を表し、基本情報（従業員番号は一意性制約付きで手動入力、枝番、氏名、生年月日、国籍、入社日、退職日、雇用区分、ステータス、部門コード、個人番号）を含む。部門コードは`部門情報.md`に記載されている4つの項目（BPS課、オンサイト課、CC課、PS課）のいずれかから選択される。最終更新日時と更新者情報を含む。従業員番号はすべての従業員間で一意であること。従業員管理ページの「雇用情報」タブに表示される。雇用区分の表示ラベルは「常勤」「パートタイム」「契約社員」として表示されるが、データベースには「FULL_TIME」「PART_TIME」「CONTRACT」として保存される。
- **雇用履歴（Employment History）**: 雇用・人事履歴を表し、期間、部門（`部門情報.md`に記載されている4つの項目（BPS課、オンサイト課、CC課、PS課）のいずれか）、有給休暇、給与参照、勤務場所履歴、勤務日数タイプ（週/月/シフト）、契約番号（contracts.idへの参照）、有効日（effective_date）、イベント種別（event_type）、契約内容の記録を含む。登録された契約番号ごとに、その契約番号に関連する勤務条件、雇用契約、書類・提出状況を保存する。注記：役職と等級はパート従業員には不要なため含まれない。最終更新日時と更新者情報を含む。
- **給与（Salary）**: 給与情報を表し、時給（複数レート対応）、残業時給、社会保険フラグ、各種手当（基本手当、職務手当、皆勤手当、その他手当）、適用期間を含む。最終更新日時と更新者情報を含む。
- **勤務条件（Work Condition）**: 包括的な勤務設定を表し、勤務時間（複数、JSONBカラム`working_hours_jsonb`に配列形式で格納）、休憩時間（複数、JSONBカラム`break_hours_jsonb`に配列形式で格納）、勤務場所（複数、JSONBカラム`work_locations_jsonb`に配列形式で格納）、有給休暇付与基準日、交通費情報（ルート別、往復金額、月額定期、上限金額、最寄り駅、JSONBカラム`transportation_routes_jsonb`に配列形式で格納）を含む。最終更新日時と更新者情報を含む。物理的には`work_conditions`テーブル1つに統合され、JSONBカラムで複数の値を配列形式で管理する。
- **契約（Contract）**: 雇用契約を表し、契約種別（INDEFINITE/FIXED_TERM）、契約期間（契約開始日`contract_start_date`、雇用満了予定日`employment_expiry_scheduled_date`、実際の雇用満了日`employment_expiry_date`）、契約更新フラグ、有期契約基準日、業務内容、有給休暇条項、時給、残業時給、雇用終了アラートフラグを含む。最終更新日時と更新者情報を含む。契約満了予定日が当日の日付を過ぎている場合、「要更新」の表示対象となる。
- **契約アラート（Contract Alert）**: 契約更新アラートを表し、契約ID参照、アラート種別（期限前通知、雇用終了通知）、通知日時、通知対象、アラートステータス（未通知/通知済/確認済）、最終更新日時を含む。
- **契約変更履歴（Contract Change History）**: 契約変更履歴を表し、契約ID参照、変更日時、変更項目、変更前値、変更後値、変更理由、更新者、変更承認者を含む。
- **書類提出（Document Submission）**: 提出書類・預かり品を表し、従業員ID参照、書類種別（提出/預かり）、書類名（雇用契約書、雇用保険被保険者証、年金手帳、健康保険証、退職届、セキュリティカード等）、提出日、返却予定日、返却日、ステータス（未提出/提出済/返却済）、備考、最終更新日時、更新者を含む。
- **書類（Document）**: 契約書類を表し、書類ID、承認番号、契約期間参照、書類種別、ステータス（現場作成中/事業部長押印待ち/総務提出済/本人返却済）、作成日時、承認日時、書類データ（PDF）、最終更新日時、更新者を含む。
- **編集ロック（Edit Lock）**: 同時編集を防止するための編集ロックを表し、対象レコードID、ロック取得者、ロック取得時刻、ロック有効期限を含む。

## 成功基準 *(必須)*

### 測定可能な成果

- **SC-001**: 統括人事管理者が従業員登録（基本情報と勤務条件）を従業員1人あたり5分以内に完了できること
- **SC-002**: 統括人事管理者が雇用契約書PDFを契約1件あたり2分以内に生成できること
- **SC-002-1**: 統括人事管理者が契約書.pdfを元にした契約書PDFを、データベースの登録情報（契約者の氏名、作成年月日、雇用期間、就業の場所、業務の内容、勤務日、社会保険加入、休暇、賃金）を自動入力して1件あたり2分以内に生成できること
- **SC-002-2**: 統括人事管理者が誓約書.pdfを元にした誓約書PDFを、社員番号のみを自動入力し、その他の部分はそのままPDFで出力して1件あたり30秒以内に生成できること
- **SC-003**: 統括人事管理者が100人の従業員の給与計算用CSVデータを30秒以内に抽出できること
- **SC-004**: システムが従業員一覧の検索結果を1000人までのクエリに対して2秒以内に表示すること
- **SC-005**: 契約更新アラートが100%の精度で自動送信されること（30日以内に期限が切れる契約の通知漏れがないこと）
- **SC-006**: 同時編集の競合が100%防止されること（同時編集によるデータ破損がないこと）
- **SC-007**: すべての契約変更が100%の精度で監査ログに記録されること（記録漏れがないこと）
- **SC-008**: ユーザーが自分のロールで許可されたデータのみに100%の精度でアクセスできること（個人番号や給与情報への不正アクセスがないこと）
- **SC-009**: 雇用契約書の手入力作業が従来のExcelベースのプロセスと比較して少なくとも80%削減されること
- **SC-010**: 給与データ作成の手入力作業が従来のプロセスと比較して少なくとも70%削減されること
- **SC-011**: システムが少なくとも50人の同時ユーザーをパフォーマンス低下なくサポートすること
- **SC-012**: 500人の従業員のデータ抽出（CSV）が10秒以内に完了すること
- **SC-013**: 90%のユーザーがエラーなく最初の試行で従業員登録を成功させること
- **SC-014**: 契約更新アラートが正しい受信者（統括人事管理者と関連する現場マネージャー）に100%の精度で配信されること
- **SC-015**: 統括人事管理者が契約を作成し、契約開始日と雇用満了予定日を設定して保存できること（100%の成功率）
- **SC-016**: 契約更新アラートが雇用満了予定日に基づいて100%の精度で送信されること（予定日の30日前、14日前、7日前）
- **SC-017**: 雇用期間の表示が「契約開始日〜雇用満了予定日」として正確に表示されること（100%の精度）
- **SC-018**: 実際の雇用満了日を設定した場合、その日付が正しく記録され、表示されること（100%の精度）
- **SC-019**: 統括人事管理者が勤務条件を登録し、複数の勤務時間帯、休憩時間帯、勤務場所、交通費情報を1つの操作で保存できること（100%の成功率）
- **SC-020**: 統合構造でも、1つの勤務条件に対して複数の勤務時間帯（最大10件）を設定できること（100%の精度）
- **SC-021**: 統合構造でも、1つの勤務条件に対して複数の勤務場所（最大10件）を設定できること（100%の精度）
- **SC-022**: 統合構造でも、1つの勤務条件に対して複数の交通費情報（最大10件）を設定できること（100%の精度）
- **SC-023**: 契約管理画面で、契約満了予定日が当日の日付を過ぎている契約に対して100%の精度で「要更新」の表示がされること
- **SC-024**: 従業員詳細ページで、契約満了予定日が当日の日付を過ぎている契約に対して100%の精度で「要更新」の表示がされること
- **SC-025**: 従業員管理ページで、契約満了予定日が当日の日付を過ぎている契約を持つ従業員に対して100%の精度で「要更新」の表示がされること
- **SC-026**: 契約満了予定日が当日または未来の日付の契約に対して、「要更新」の表示がされないこと（100%の精度）
- **SC-027**: 契約満了予定日が設定されていない契約に対して、「要更新」の表示がされないこと（100%の精度）
- **SC-028**: 統括人事管理者が契約管理画面を表示してから、更新が必要な契約を識別するまでの時間が3秒以内であること
- **SC-029**: 「要更新」の表示が視覚的に識別可能であること（ユーザビリティテストで90%以上のユーザーが正しく識別できること）
- **SC-030**: 従業員登録・編集画面で、雇用区分の選択肢に「常勤」「パートタイム」「契約社員」が100%の精度で表示されること
- **SC-031**: 従業員一覧画面で、各従業員の雇用区分が「常勤」「パートタイム」「契約社員」のいずれかで100%の精度で表示されること
- **SC-032**: 従業員詳細画面で、従業員の雇用区分が「常勤」「パートタイム」「契約社員」のいずれかで100%の精度で表示されること
- **SC-033**: データベースに保存されている雇用区分の値（FULL_TIME, PART_TIME, CONTRACT）が変更されないこと（100%の精度）
- **SC-034**: 統括人事管理者が契約管理画面の一覧で、3点メニューをクリックしてから操作メニューが表示されるまでの時間が1秒以内であること
- **SC-035**: 統括人事管理者が契約の新規作成・更新画面で、contractsテーブルとwork_conditionsテーブルの情報を入力して保存できること（100%の成功率）
- **SC-036**: 新しい契約が作成された場合、employment_historyテーブルに登録された契約番号ごとに、その契約番号に関連する勤務条件、雇用契約、書類・提出状況が100%の精度で記録されること
- **SC-037**: 契約が更新された場合、employment_historyテーブルに更新後の契約番号ごとに、その契約番号に関連する勤務条件、雇用契約、書類・提出状況が100%の精度で記録されること
- **SC-038**: 従業員管理画面の詳細ページで、有効な契約の情報が100%の精度で表示されること（雇用期間開始日による判定が正しく動作すること）
- **SC-039**: 統括人事管理者が契約の新規作成から保存までを5分以内に完了できること
- **SC-040**: 統括人事管理者が契約の更新から保存までを3分以内に完了できること
- **SC-041**: 従業員管理画面の詳細ページで、契約情報の表示切り替え（現行契約から新規契約への切り替え）が即座に反映されること（画面再読み込み不要）
- **SC-042**: ダッシュボードの「本日の重要タスク」一覧で、ステータスが「要更新」のタスクが100%の精度で赤色で表示されること
- **SC-043**: ダッシュボードの「本日の重要タスク」一覧で、各タスクの優先度が契約残り日数と「要更新」ステータスに基づいて100%の精度で正しく設定されること
- **SC-044**: ダッシュボードの「本日の重要タスク」一覧で、優先度「高」のタスクが最上部に表示され、次に「中」、「低」の順で表示されること（100%の精度）
- **SC-045**: ダッシュボードに3つの統計カード（従業員数、今月の契約処理、契約更新予定）が100%の精度で表示されること
- **SC-046**: 各統計カードに正確な数値が表示されること（従業員数：100%の精度、今月の契約処理：100%の精度、契約更新予定：100%の精度）
- **SC-047**: 統括人事管理者がダッシュボードを表示してから、重要タスクの優先度を識別するまでの時間が2秒以内であること
- **SC-048**: 統計カードをクリックした際、該当する詳細画面に1秒以内に遷移できること
- **SC-049**: 統括人事管理者が従業員管理ページから「従業員情報を編集」画面を開いた場合、基本情報のみが編集可能で、勤務条件、雇用契約、書類・提出状況のウィジェットが表示のみであることを100%の精度で確認できること
- **SC-050**: 統括人事管理者が契約管理ページから「契約更新」または「新規契約作成」画面を開いた場合、基本情報が表示のみで、勤務条件、雇用契約、書類・提出状況の各ウィジェットが編集可能であることを100%の精度で確認できること
- **SC-051**: 統括人事管理者が「契約更新」または「新規契約作成」画面で、統合されたウィジェットの先頭に契約番号の入力欄が表示されることを100%の精度で確認できること
- **SC-052**: 統括人事管理者が契約番号を入力して保存した場合、契約番号が100%の精度で正しく保存されること
- **SC-053**: 編集可能なウィジェットと読み取り専用のウィジェットが視覚的に区別できること（ユーザビリティテストで90%以上のユーザーが正しく識別できること）
- **SC-054**: 統括人事管理者が従業員管理ページから「従業員情報を編集」画面で契約番号を入力・管理できること（100%の成功率）
- **SC-055**: 統括人事管理者が契約管理ページの操作メニューから「契約書プレビュー」または「誓約書プレビュー」を選択した際、ポップアップで書類が表示されること（100%の精度）
- **SC-056**: 統括人事管理者がプレビューポップアップからダウンロードまたは印刷を実行した際、書類が正しくダウンロードまたは印刷されること（100%の成功率）
- **SC-057**: 統括人事管理者が契約管理ページで複数の契約にチェックを入れ、「一括ダウンロード」ボタンをクリックした際、選択した契約の契約書または誓約書が一括でダウンロードされること（100%の成功率）
- **SC-058**: 統括人事管理者が契約管理ページで複数の契約にチェックを入れ、「一括印刷」ボタンをクリックした際、選択した契約の契約書または誓約書が一括で印刷されること（100%の成功率）
- **SC-059**: 統括人事管理者が10件の契約を一括ダウンロードまたは一括印刷する場合、処理が3分以内に完了すること

## UI要件

- **UI-001**: システムは従業員登録・編集フォームで雇用開始日と雇用終了日を近い場所に表示し、使いやすさを向上させ、入力エラーを削減すること
- **UI-002**: システムは従業員一覧画面からチェックボックスと一括操作コントロールを使用して、複数選択した従業員の書類ステータスを更新できること
- **UI-003**: システムは契約登録・編集フォームで契約開始日と雇用満了予定日を近い場所に表示し、使いやすさを向上させること
- **UI-004**: システムは実際の雇用満了日を別のセクションまたはフィールドとして表示し、予定日と区別できるようにすること
- **UI-005**: システムは勤務条件登録・編集フォームで、勤務時間帯、休憩時間帯、勤務場所、交通費情報を統合されたUIで表示・編集できること
- **UI-006**: システムは複数の値を追加・削除・編集する操作を直感的に行えること（動的な追加・削除ボタンなど）
- **UI-007**: システムは「要更新」の表示を、契約一覧や従業員一覧で視覚的に目立つ形式（例：赤色のバッジ、警告アイコン、強調表示など）で行うこと
- **UI-008**: システムは「要更新」の表示がされている契約または従業員をクリックした場合、契約詳細画面または従業員詳細ページに遷移できること
- **UI-009**: システムは「要更新」の表示と同時に、契約満了予定日を表示すること（ユーザーがどの日付を基準に判定されているかを確認できるようにする）
- **UI-010**: システムは雇用区分の表示ラベルを、すべての画面（登録・編集・一覧・詳細）で一貫して「常勤」「パートタイム」「契約社員」として表示すること
- **UI-011**: システムは雇用区分の選択肢（ドロップダウン、ラジオボタンなど）で、「常勤」「パートタイム」「契約社員」の3つの選択肢を表示すること
- **UI-012**: システムは契約管理画面の一覧表示で、操作列をアラート列の右側に配置し、3点メニューアイコンを視覚的に識別しやすい形式で表示すること
- **UI-013**: システムは3点メニューのポップアップを、クリックした位置の近くに表示し、メニュー項目を明確に区別できる形式で表示すること
- **UI-014**: システムは契約の新規作成・更新画面で、contractsテーブルとwork_conditionsテーブルの情報を、論理的にグループ化して表示し、入力しやすい形式で提供すること
- **UI-015**: システムは契約削除時に、削除確認ダイアログを表示し、削除の影響（関連する履歴やデータへの影響）を明確に示すこと
- **UI-016**: システムは従業員管理画面の詳細ページで、有効な契約の情報がどの契約に基づいているかを明確に表示すること（契約番号や契約期間の表示）
- **UI-017**: システムは「要更新」ステータスを赤色で表示し、視覚的に識別しやすい形式（例：赤色のテキスト、赤色のバッジ、赤色の背景など）で表示すること
- **UI-018**: システムは「本日の重要タスク」一覧で、優先度を視覚的に識別できる形式（例：優先度「高」は強調表示、優先度「中」は通常表示、優先度「低」は控えめな表示）で表示すること
- **UI-019**: システムは統計カードを、視覚的に区別できる形式（例：カード形式、アイコン付き、数値の強調表示など）で表示すること
- **UI-020**: システムは統計カードをクリック可能な形式で表示し、ホバー時に視覚的なフィードバック（例：カーソル変更、カードの強調表示など）を提供すること
- **UI-021**: システムは従業員管理ページから「従業員情報を編集」画面を開いた場合、基本情報ウィジェットを編集可能な形式で表示し、勤務条件、雇用契約、書類・提出状況のウィジェットを読み取り専用（表示のみ）の形式で表示すること。
- **UI-022**: システムは契約管理ページから「契約更新」または「新規契約作成」画面を開いた場合、基本情報ウィジェットを読み取り専用（表示のみ）の形式で表示し、勤務条件、雇用契約、書類・提出状況の各ウィジェットを編集可能な形式で表示すること。
- **UI-023**: システムは「契約更新」または「新規契約作成」画面で、勤務条件セクション、雇用契約セクション、書類・提出状況セクションを1つの大きなウィジェットとして統合し、視覚的に1つのまとまりとして表示すること。
- **UI-024**: システムは統合されたウィジェットの先頭に契約番号の入力欄を配置し、他のセクションと明確に区別できる形式で表示すること。
- **UI-025**: システムは編集可能なウィジェットと読み取り専用のウィジェットを視覚的に区別できる形式（例：編集可能なウィジェットは通常の背景色、読み取り専用のウィジェットはグレーアウトまたは背景色を変更）で表示すること。
- **UI-026**: システムは従業員管理ページから「従業員情報を編集」画面で、勤務条件、雇用契約、書類・提出状況のウィジェットに対して契約番号の入力欄を表示すること。
- **UI-027**: システムは契約管理ページの操作メニューに「契約書プレビュー」と「誓約書プレビュー」のメニュー項目を明確に区別できる形式で表示すること。
- **UI-028**: システムはプレビューポップアップを、画面中央または適切な位置に表示し、書類の内容が読みやすい形式で表示すること。
- **UI-029**: システムはプレビューポップアップにダウンロードボタンと印刷ボタンを明確に識別できる形式で配置すること。
- **UI-030**: システムは契約管理ページの「CSV/給与データ抽出」ボタンの左に「一括ダウンロード」ボタンと「一括印刷」ボタンを配置し、視覚的に区別できる形式で表示すること。
- **UI-031**: システムはチェックボックスにチェックが入っていない場合、「一括ダウンロード」ボタンと「一括印刷」ボタンを無効化するか、適切なメッセージを表示すること。

## 従業員管理ページの表示データ項目

従業員管理ページは以下の4つのタブで構成され、各タブに以下のデータ項目を表示する。

### 雇用情報タブ

- 社員番号（従業員番号）
- 氏名
- 部門（部門コード）
- 契約番号（contractsテーブルのid）
- 入社日（雇用開始日）
- 雇用期間（契約開始日〜契約終了日）
- 退社日（雇用終了日）

### 勤務情報タブ

- 契約書有給（有給休暇条項）
- 勤務時間（複数の勤務時間帯）
- 休憩時間（複数の休憩時間帯）
- 勤務日数/週（勤務日数タイプと勤務日数）
- 勤務場所（複数の勤務場所）
- 業務内容（契約の業務内容）

### 給与・手当タブ

- 時給
- 残業時給（残業時の時給）
- 最寄り駅（交通費ルートの最寄り駅）
- 交通費（片道/往復）（交通費ルート別の往復金額）
- 控除申告書（甲乙）（源泉徴収の控除申告書の種類）
- 雇用保険（加入/未加入）
- 雇用保険書提出（雇用保険被保険者証の提出状況）
- 社会保険（加入/未加入）
- 社会保険関連書類の提出状況（年金手帳、健康保険証の提出状況）

### 書類タブ

- 保険証授（健康保険証の授受状況）
- 雇用契約書他管理へ提出（日付）（雇用契約書等の管理部門への提出日）
- 本人へ返却（書類の本人への返却状況）
- 満了通知書発効（契約満了通知書の発行状況）
- 退職届提出（退職届の提出状況）
- 返却
  - 保険証（健康保険証の返却状況）
  - セキュリティカード（セキュリティカードの返却状況）

## 前提条件

- ユーザーは適切なアクセス認証情報とロール割り当て（統括人事管理者、現場マネージャー、管理者、監査人）を持っていること
- 従業員データは既存のExcelファイルからCSVインポートで移行されること
- 個人情報最小化ポリシーに従うこと（住所、電話番号、銀行口座情報は保存しない）。連絡先情報（住所、電話番号）は統括人事管理者には不要だが、現場マネージャーの必要性は検討中である。ただし、連絡先情報の保存は重要な個人情報の取り扱いを伴うため、慎重な検討が必要である。
- 銀行口座情報はシステムに保存されないこと
- 契約書類は指定された形式に従って生成された場合、法的に有効であること
- システムは通常の営業時間（8:00-20:00）に標準的な可用性の期待値で動作すること
- ユーザーは基本的なコンピュータリテラシーを持ち、Webベースのインターフェースを操作できること
- システムにアクセスするすべてのユーザーに対してネットワーク接続が利用可能であること
- 従業員データ（退職者を含む）は法的要件（労働関係書類の保存期間）に準拠して退職日から7年間保持されること。7年後は組織の方針に従ってアーカイブまたは削除されること。
- 既存の契約データ（contract_end_date）が存在する場合、移行処理が必要
- システムは既存の契約管理機能が動作していること
- 既存の分散テーブル構造（working_hours、break_hours、work_locations、transportation_routes）にデータが存在する場合、マイグレーションでJSONBカラムに移行される
- PostgreSQLのJSONB型がサポートされていること
- 契約テーブルに雇用満了予定日（employment_expiry_scheduled_date）フィールドが存在すること
- ダッシュボード画面が既に存在し、「本日の重要タスク」一覧が表示されていること
- 「要更新」ステータスの判定機能が実装されていること
- 契約管理画面が既に存在し、一覧表示機能が動作していること
- contractsテーブルとwork_conditionsテーブルが存在し、適切なスキーマ定義がされていること
- employment_historyテーブルが存在し、契約番号を記録できる構造になっていること
- 従業員管理画面の詳細ページが既に存在し、勤務情報、給与・手当、書類、備考の各タブが実装されていること

## 依存関係

- インポートが必要な既存のExcel形式の従業員データ
- 雇用契約と個人情報保護に関する法的要件
- 組織内の承認ワークフロー（現場 → 事業部 → 管理者）
- 将来の外部システムとの統合（現在、外部統合は計画されていない）
- データベースに設定する部門情報：`部門情報.md`に記載されている4つの項目（BPS課、オンサイト課、CC課、PS課）
- 既存の契約管理機能
- 契約更新アラート機能
- 契約履歴表示機能
- 既存の勤務条件管理機能
- データ移行処理の実行環境
- 既存のダッシュボード機能
- 契約テーブルの雇用満了日管理機能
- 契約満了予定日超過時の「要更新」表示機能
- 従業員管理機能
- 契約管理機能
- データベーススキーマ（database/supabase_schema.sql）の雇用区分制約定義

## 対象外

- 外部給与システムとのリアルタイム同期
- モバイルアプリケーション開発（Webアプリケーションのみ）
- 基本的な従業員検索・一覧表示を超えた高度な分析・レポートダッシュボード
- 自動契約更新処理（アラートのみ、手動更新が必要）
- 時間追跡または出勤管理システムとの統合
- 多言語サポート（日本語のみ）
- オフライン機能
- 雇用履歴の役職・等級フィールド（パート従業員には不要）
- 銀行口座情報の保存（個人情報最小化ポリシー）
- 連絡先情報（住所、電話番号）の保存（個人情報最小化ポリシー、ただし現場マネージャーの必要性は検討中）
- 契約終了日（contract_end_date）フィールドの即座の削除（後方互換性のため、段階的な移行を想定）
- 雇用満了予定日の自動計算機能（手動入力のみ）
- 複数の雇用満了予定日の管理（1契約あたり1つの予定日）
- 統合構造以外のデータ形式への対応
- 既存データの自動バックアップ機能（手動バックアップを推奨）
- JSONBカラムの検索・フィルタリング機能の最適化（基本的なGINインデックスのみ提供）
- 契約満了予定日が近づいている（まだ過ぎていない）契約への警告表示（本機能は「過ぎている」契約のみを対象）
- 契約更新の自動化機能（表示のみで、更新手続きは手動）
- 「要更新」表示の通知機能（画面表示のみで、メール通知などは対象外）
- 契約満了予定日の自動計算機能（既存の手動入力方式を維持）
- データベースの値（FULL_TIME, PART_TIME, CONTRACT）の変更（表示ラベルの変更のみ）
- 雇用区分の種類の追加・削除（既存の3種類の表示ラベルの変更のみ）
- CSVエクスポート時の表示ラベル変換（データベースの値をそのまま出力）
- APIレスポンスの表示ラベル変換（データベースの値をそのまま返す）
- 契約プレビュー画面でのPDF出力機能（既存のPDF出力機能を利用）
- 契約削除時の関連データの自動削除（履歴は保持）
- 契約の承認ワークフロー（承認機能は対象外）
- 統計カードの詳細な分析機能（数値の表示のみ）
- 優先度の手動変更機能（自動判定のみ）
- ダッシュボードのカスタマイズ機能（表示内容の固定）
- 過去の統計データの表示（現在の数値のみ）
